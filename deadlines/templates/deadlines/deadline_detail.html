{% extends "deadlines/base.html" %} {% load static %} {% block title %}{{
deadline.title }} - Business Deadlines{% endblock %} {% block content %}
<div class="detail-header">
  <a href="javascript:history.back()" class="detail-back">← Back</a>
  <div class="detail-title">{{ deadline.title }}</div>
  <div class="detail-meta">
    <span class="detail-entity-badge">{{ deadline.entity.entity_code }}</span>
    <span
      >{{ deadline.category|default:"General" }} · {{
      deadline.get_frequency_display|default:"One-time" }}</span
    >
  </div>
</div>

<div class="detail-content">
  <div class="detail-card">
    <h3>Deadline Information</h3>
    <div class="detail-grid">
      <div class="detail-field">
        <span class="detail-label">Next Due</span>
        <span
          class="detail-value {% if deadline.urgency_status == 'overdue' %}overdue{% elif deadline.urgency_status == 'upcoming' %}upcoming{% endif %}"
        >
          {{ deadline.next_due|date:"M j, Y" }}
        </span>
      </div>
      <div class="detail-field">
        <span class="detail-label">Status</span>
        <span
          class="detail-value {% if deadline.urgency_status == 'overdue' %}overdue{% elif deadline.urgency_status == 'upcoming' %}upcoming{% endif %}"
        >
          {% if deadline.urgency_status == 'overdue' %} Overdue {% elif
          deadline.urgency_status == 'upcoming' %} Due soon {% else %} On track
          {% endif %}
        </span>
      </div>
      {% if deadline.estimated_amount %}
      <div class="detail-field">
        <span class="detail-label">Amount</span>
        <span class="detail-value amount"
          >${{ deadline.estimated_amount }}</span
        >
      </div>
      {% endif %}
      <div class="detail-field">
        <span class="detail-label">Auto-Pay</span>
        <span class="detail-value"
          >{% if deadline.autopay %}Yes{% else %}No{% endif %}</span
        >
      </div>
      {% if deadline.account_number %}
      <div class="detail-field">
        <span class="detail-label">Account #</span>
        <span class="detail-value" style="font-family: monospace"
          >{{ deadline.account_number }}</span
        >
      </div>
      {% endif %} {% if deadline.remind_days_before %}
      <div class="detail-field">
        <span class="detail-label">Remind</span>
        <span class="detail-value"
          >{{ deadline.remind_days_before }} days before</span
        >
      </div>
      {% endif %}
    </div>
  </div>

  {% if deadline.notes %}
  <div class="detail-card">
    <h3>Notes</h3>
    <div class="notes-list">
      <div class="note-item">{{ deadline.notes|linebreaks }}</div>
    </div>
  </div>
  {% endif %}

  <div class="detail-actions">
    <form
      method="post"
      action="{% url 'deadlines:deadline_complete' deadline.pk %}"
      style="flex: 1"
    >
      {% csrf_token %}
      <button type="submit" class="btn-success">✓ Mark Complete</button>
    </form>
  </div>

  {% if deadline.frequency %}
  <div class="auto-advance-note">
    → NextDue advances to {% if deadline.frequency == 'monthly' %} next month {%
    elif deadline.frequency == 'quarterly' %} +3 months {% elif
    deadline.frequency == 'annually' %} next year {% endif %}
  </div>
  {% endif %}

  <div class="detail-card" style="margin-top: 20px">
    <h3>Add Note</h3>
    <form
      method="post"
      action="{% url 'deadlines:deadline_add_note' deadline.pk %}"
    >
      {% csrf_token %}
      <div class="form-group" style="margin-bottom: 12px">
        <textarea
          name="note"
          class="form-textarea"
          placeholder="Enter note..."
        ></textarea>
      </div>
      <button type="submit" class="action-button secondary">Add Note</button>
    </form>
  </div>
</div>
{% endblock %}
